# ServerRoot /code

# Listen 80

# <IfModule unixd_module>
#     User apache
#     Group apache
# </IfModule>

# ServerName jakubk.pl
# ServerAdmin kuba1095@gmail.com
ServerTokens Prod
ServerSignature Off
WSGIPythonHome /code/myenv_linux
WSGIPythonPath /code/portfolio_manager


# # IncludeOptional /etc/apache2/conf.d/*.conf

AddDefaultCharset UTF-8
EnableSendfile on

FileETag None
TraceEnable off
Header edit Set-Cookie ^(.*)$ $1;HttpOnly;Secure
Header always append X-Frame-Options SAMEORIGIN
Header set X-XSS-Protection "1; mode=block"
RewriteEngine On
RewriteCond %{THE_REQUEST} !HTTP/1.1$
RewriteRule .* - [F]
Timeout 60

# <IfModule dir_module>
#     DirectoryIndex index.html
# </IfModule>
<Files ".ht*">
    Require all denied
</Files>

# <IfModule log_config_module>
#     LogFormat "%h %l %u %t \"%r\" %>s %b \"%{Referer}i\" \"%{User-Agent}i\"" combined
#     LogFormat "%h %l %u %t \"%r\" %>s %b" common

#     <IfModule logio_module>
#       LogFormat "%h %l %u %t \"%r\" %>s %b \"%{Referer}i\" \"%{User-Agent}i\" %I %O" combinedio
#     </IfModule>
#     CustomLog "logs/access_log" combined
# </IfModule>

# ErrorLog logs/error.log

LogLevel info


<VirtualHost *:80>
    ServerAdmin kuba1095@gmail.com
    ServerName jakubk.pl
    ServerAlias www.jakubk.pl
    

    <Location /status >
        SetHandler server-status
    </Location>

    <Location / >
        Redirect / https://jakubk.pl/
    </Location>

    # Alias "/.well-known/acme-challenge" "/data/letsencrypt"
    # <Directory "/data/letsencrypt">
    #     Options Indexes FollowSymLinks MultiViews
    #     Require all granted
    # </Directory>

    # <Directory />
    #     AllowOverride none
    #     Options -Indexes -Includes
    #     Require all granted
    #     <LimitExcept GET POST HEAD>
    #         deny from all
    #     </LimitExcept>
    # </Directory>

#     <Directory "/var/www/localhost/htdocs">
#         AllowOverride None
#         Options -Indexes -Includes
#         Require all granted
#     </Directory>


</VirtualHost>

<IfModule mod_ssl.c>
    <VirtualHost *:443>
        ServerAdmin kuba1095@gmail.com
        ServerName jakubk.pl
        ServerAlias www.jakubk.pl


        # <Directory />
        #     AllowOverride none
        #     Options -Indexes -Includes
        #     Require all granted
        #     <LimitExcept GET POST HEAD>
        #         deny from all
        #     </LimitExcept>
        # </Directory>

        # <Directory "/var/www/localhost/htdocs">
        #     AllowOverride None
        #     Options -Indexes -Includes
        #     Require all granted
        # </Directory>

        # new
        WSGIScriptAlias / /code/portfolio_manager/portfolio_manager/wsgi.py
        WSGIDaemonProcess portfolio_manager python-home=/code/myenv_linux python-path=/code/portfolio_manager
        WSGIProcessGroup portfolio_manager
        WSGIPassAuthorization On


        Alias /static/ /code/portfolio_manager/portfolio_manager/static/
        <Directory /code/portfolio_manager/portfolio_manager/static>
                Require all granted
        </Directory>

        <Directory /code/portfolio_manager/portfolio_manager/>
            <Files wsgi.py>
                    Require all granted
            </Files>
        </Directory>

        # new

        <Location /status >
            SetHandler server-status
        </Location>
    
        # ErrorLog logs/error.log
        # LogLevel info
        # CustomLog "logs/access_log" combined

        SSLEngine On
        SSLProtocol                         all -SSLv2 -SSLv3
        SSLCipherSuite                      ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-AES128-SHA256:ECDHE-RSA-AES128-SHA256:ECDHE-ECDSA-AES128-SHA:ECDHE-RSA-AES256-SHA384:ECDHE-RSA-AES128-SHA:ECDHE-ECDSA-AES256-SHA384:ECDHE-ECDSA-AES256-SHA:ECDHE-RSA-AES256-SHA:DHE-RSA-AES128-SHA256:DHE-RSA-AES128-SHA:DHE-RSA-AES256-SHA256:DHE-RSA-AES256-SHA:ECDHE-ECDSA-DES-CBC3-SHA:ECDHE-RSA-DES-CBC3-SHA:EDH-RSA-DES-CBC3-SHA:AES128-GCM-SHA256:AES256-GCM-SHA384:AES128-SHA256:AES256-SHA256:AES128-SHA:AES256-SHA:DES-CBC3-SHA:!DSS
        SSLHonorCipherOrder                 on
        SSLOptions                          +StrictRequire
        SSLCertificateFile                  /etc/letsencrypt/live/jakubk.pl/cert.pem
        SSLCertificateKeyFile               /etc/letsencrypt/live/jakubk.pl/privkey.pem
        SSLCertificateChainFile             /etc/letsencrypt/live/jakubk.pl/fullchain.pem
    </VirtualHost>
</IfModule>




